import{_ as q,f as b,g as R,h as M,i as B,q as O,j as $,k as V,l as T,m as z,p as G,o as r,c as n,a as s,s as H,u as J,t as c,b as p,v,x as g,y as K,F as X,r as Y,A as _,J as Q,K as W,N as Z,M as ee,D as x,E as se,z as C,G as U,d as te,n as le,H as oe}from"./index-0876195e.js";const ae={class:"admin"},ie={class:"container py-5"},re={class:"d-flex align-items-center justify-content-between flex-wrap gap-2 mb-4"},ne={key:0,class:"card mb-4"},ue=["disabled"],de={key:0,class:"mt-2 text-danger mb-0"},ce={class:"card mb-4"},me={class:"h5 fw-bold mb-3"},pe={class:"row g-3"},fe={class:"col-md-6"},ve={class:"col-md-6"},be={class:"col-12"},ge=["disabled"],_e={key:0,class:"muted mt-2"},ye={class:"col-12"},he={class:"col-12"},xe={class:"col-md-4"},ke={class:"col-md-4"},Pe={class:"col-md-4"},De={class:"col-12 d-flex flex-wrap gap-2"},Ve=["disabled"],Fe=["disabled"],we={key:0,class:"mt-2 text-danger mb-0"},Ce={class:"card"},Ue={class:"d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3"},Ne={class:"badge"},Ae={key:0,class:"empty"},Se={key:1,class:"empty"},Le={key:2,class:"list"},je={class:"info"},Ee={class:"top"},Ie={class:"name"},qe={class:"meta"},Re={key:0,class:"pill"},Me={class:"pill muted-pill"},Be={key:1,class:"pill muted-pill"},Oe={key:0,class:"desc"},$e={class:"links"},Te=["href"],ze={key:1,class:"warn"},Ge={class:"actions"},He=["onClick","disabled"],Je=["onClick","disabled"],Ke={__name:"AdminDocuments",setup(Xe){const y=b(!0),d=b(!1),f=b(!1),i=b(""),h=b([]);let k=null;const m=b(null),t=R({title:"",category:"",url:"",description:"",order:1,maxPages:null,isVisible:!0}),P=M(()=>[...h.value].sort((o,e)=>(o.order??999)-(e.order??999)));function D(){t.title="",t.category="",t.url="",t.description="",t.order=1,t.maxPages=null,t.isVisible=!0}B(()=>{const o=O(V(_,"documents"),$("order","asc"));k=T(o,e=>{h.value=e.docs.map(u=>({id:u.id,...u.data()})),y.value=!1},e=>{console.error(e),i.value="Erreur Firestore (documents). VÃ©rifie rules + config Firebase.",y.value=!1})}),z(()=>{k&&k()});async function N(o){var u,l;const e=(u=o.target.files)==null?void 0:u[0];if(e){if(i.value="",e.type!=="application/pdf"){i.value="Veuillez choisir un fichier PDF.",o.target.value="";return}f.value=!0;try{const a=(e.name||"document.pdf").replace(/\s+/g,"_"),E=`documents/${Date.now()}_${a}`,w=Q(W,E);await Z(w,e);const I=await ee(w);t.url=I,(l=t.title)!=null&&l.trim()||(t.title=a.replace(/\.pdf$/i,""))}catch(a){console.error(a),i.value=(a==null?void 0:a.message)||"Upload impossible (Storage)."}finally{f.value=!1,o.target.value=""}}}async function A(){var o,e,u,l;if(i.value="",!((o=t.title)!=null&&o.trim())){i.value="Le titre est obligatoire.";return}if(!((e=t.url)!=null&&e.trim())){i.value="Le lien du PDF est obligatoire (colle une URL ou upload un PDF).";return}d.value=!0;try{const a={title:t.title.trim(),category:((u=t.category)==null?void 0:u.trim())||"",url:t.url.trim(),description:((l=t.description)==null?void 0:l.trim())||"",order:Number.isFinite(t.order)?Number(t.order):999,maxPages:Number.isFinite(t.maxPages)?Number(t.maxPages):null,isVisible:!!t.isVisible,updatedAt:x()};m.value?(await se(C(_,"documents",m.value),a),m.value=null,D()):(await U(V(_,"documents"),{...a,createdAt:x()}),D())}catch(a){console.error(a),i.value=(a==null?void 0:a.message)||"Erreur lors de lâ€™enregistrement"}finally{d.value=!1}}function S(o){m.value=o.id,t.title=o.title||"",t.category=o.category||"",t.url=o.url||"",t.description=o.description||"",t.order=Number.isFinite(o.order)?Number(o.order):999,t.maxPages=Number.isFinite(o.maxPages)?Number(o.maxPages):null,t.isVisible=o.isVisible!==!1}function F(){m.value=null,D()}async function L(o){if(i.value="",!!window.confirm("Supprimer ce document ?"))try{await oe(C(_,"documents",o)),m.value===o&&F()}catch(u){console.error(u),i.value=(u==null?void 0:u.message)||"Erreur lors de la suppression"}}async function j(){if(i.value="",d.value||h.value.length>0)return;const o=[{title:"Charte ISF",category:"Officiel",url:"/documents/charte-isf.pdf",description:"Document officiel â€” Charte ISF ULaval",order:1,isVisible:!0,maxPages:29,createdAt:x(),updatedAt:x()}];d.value=!0;try{for(const e of o)await U(V(_,"documents"),e)}catch(e){console.error(e),i.value=(e==null?void 0:e.message)||"Import impossible"}finally{d.value=!1}}return(o,e)=>{const u=G("router-link");return r(),n("main",ae,[s("div",ie,[s("div",re,[e[8]||(e[8]=s("div",null,[s("h1",{class:"title"},"Gestion â€” Documents"),s("p",{class:"subtitle"},"Ajoute et organise les PDF/liens affichÃ©s sur la page â€œDocumentsâ€.")],-1)),H(u,{class:"btn-back",to:"/admin"},{default:J(()=>[...e[7]||(e[7]=[te("â† Retour au dashboard",-1)])]),_:1})]),!y.value&&h.value.length===0?(r(),n("div",ne,[e[9]||(e[9]=s("h2",{class:"h5 fw-bold mb-2"},"Importer les documents existants",-1)),e[10]||(e[10]=s("p",{class:"muted mb-3"}," Ta base Firestore est vide. Clique pour importer la charte (et autres docs si tu en ajoutes). ",-1)),s("button",{class:"btn-primary",onClick:j,disabled:d.value},c(d.value?"...":"Importer maintenant"),9,ue),i.value?(r(),n("p",de,c(i.value),1)):p("",!0)])):p("",!0),s("div",ce,[s("h2",me,c(m.value?"Modifier un document":"Nouveau document"),1),s("div",pe,[s("div",fe,[e[11]||(e[11]=s("label",{class:"form-label"},"Titre",-1)),v(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>t.title=l),class:"form-control",placeholder:"Ex: Charte ISF ULaval"},null,512),[[g,t.title,void 0,{trim:!0}]])]),s("div",ve,[e[12]||(e[12]=s("label",{class:"form-label"},"CatÃ©gorie (optionnel)",-1)),v(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.category=l),class:"form-control",placeholder:"Ex: Officiel / Recrutement / Rapports"},null,512),[[g,t.category,void 0,{trim:!0}]])]),s("div",be,[e[13]||(e[13]=s("label",{class:"form-label"},"PDF (upload)",-1)),s("input",{class:"form-control",type:"file",accept:"application/pdf",onChange:N,disabled:d.value},null,40,ge),e[14]||(e[14]=s("small",{class:"muted"}," Choisis un PDF â†’ upload vers Firebase Storage â†’ lâ€™URL sera ajoutÃ©e automatiquement. ",-1)),f.value?(r(),n("div",_e,"Upload en coursâ€¦")):p("",!0)]),s("div",ye,[e[15]||(e[15]=s("label",{class:"form-label"},"Lien du PDF (URL)",-1)),v(s("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.url=l),class:"form-control",placeholder:"https://... ou /documents/charte-isf.pdf"},null,512),[[g,t.url,void 0,{trim:!0}]]),e[16]||(e[16]=s("small",{class:"muted"}," Ce champ se remplit automatiquement aprÃ¨s upload (tu peux aussi coller un lien direct). ",-1))]),s("div",he,[e[17]||(e[17]=s("label",{class:"form-label"},"Description (optionnel)",-1)),v(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=l=>t.description=l),class:"form-control",rows:"3",placeholder:"Une phrase pour expliquer le document..."},null,512),[[g,t.description,void 0,{trim:!0}]])]),s("div",xe,[e[18]||(e[18]=s("label",{class:"form-label"},"Ordre dâ€™affichage",-1)),v(s("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.order=l),type:"number",class:"form-control",placeholder:"1"},null,512),[[g,t.order,void 0,{number:!0}]]),e[19]||(e[19]=s("small",{class:"muted"},"Plus petit = affichÃ© en premier.",-1))]),s("div",ke,[e[20]||(e[20]=s("label",{class:"form-label"},"Pages (optionnel)",-1)),v(s("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>t.maxPages=l),type:"number",class:"form-control",placeholder:"29"},null,512),[[g,t.maxPages,void 0,{number:!0}]]),e[21]||(e[21]=s("small",{class:"muted"},"Utile si tu affiches â€œPage X / Yâ€.",-1))]),s("div",Pe,[e[23]||(e[23]=s("label",{class:"form-label"},"Afficher sur la page",-1)),v(s("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>t.isVisible=l),class:"form-select"},[...e[22]||(e[22]=[s("option",{value:!0},"Oui",-1),s("option",{value:!1},"Non",-1)])],512),[[K,t.isVisible]])]),s("div",De,[s("button",{class:"btn-primary",onClick:A,disabled:d.value||f.value},c(d.value?"...":m.value?"Enregistrer":"Ajouter"),9,Ve),m.value?(r(),n("button",{key:0,class:"btn-ghost",onClick:F,disabled:d.value||f.value}," Annuler ",8,Fe)):p("",!0)]),i.value?(r(),n("p",we,c(i.value),1)):p("",!0)])]),s("div",Ce,[s("div",Ue,[e[24]||(e[24]=s("h2",{class:"h5 fw-bold mb-0"},"Documents",-1)),s("span",Ne,c(P.value.length)+" total",1)]),y.value?(r(),n("div",Ae,"Chargementâ€¦")):P.value.length===0?(r(),n("div",Se," Aucun document pour le moment. Ajoute-en un ðŸ‘† ")):(r(),n("div",Le,[(r(!0),n(X,null,Y(P.value,l=>(r(),n("div",{key:l.id,class:"item"},[s("div",je,[s("div",Ee,[s("div",Ie,c(l.title),1),s("div",qe,[l.category?(r(),n("span",Re,c(l.category),1)):p("",!0),s("span",Me,"Ordre: "+c(l.order??999),1),l.maxPages?(r(),n("span",Be,"Pages: "+c(l.maxPages),1)):p("",!0),s("span",{class:le(["pill",l.isVisible?"ok":"off"])},c(l.isVisible?"Visible":"MasquÃ©"),3)])]),l.description?(r(),n("p",Oe,c(l.description),1)):p("",!0),s("div",$e,[l.url?(r(),n("a",{key:0,class:"link",href:l.url,target:"_blank",rel:"noreferrer"},"Ouvrir le PDF",8,Te)):(r(),n("span",ze,"âš ï¸ Aucun lien fourni"))])]),s("div",Ge,[s("button",{class:"btn-small",onClick:a=>S(l),disabled:d.value||f.value},"Modifier",8,He),s("button",{class:"btn-small danger",onClick:a=>L(l.id),disabled:d.value||f.value},"Supprimer",8,Je)])]))),128))])),e[25]||(e[25]=s("p",{class:"hint"},"âœ… Persistant : ajout / modification / suppression = Firestore.",-1))])])])}}},Qe=q(Ke,[["__scopeId","data-v-248fb2fa"]]);export{Qe as default};
