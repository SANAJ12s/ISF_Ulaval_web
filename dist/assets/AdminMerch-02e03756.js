import{_ as q,f as u,g as M,h as P,i as $,q as z,j as G,k as D,l as H,m as Q,p as W,o as n,c as i,a as s,s as J,u as K,b as g,v,x as b,t as d,y as X,F as Y,r as Z,d as k,z as I,A as p,B as ee,C as se,D as U,E as S,G as te,n as le,H as oe}from"./index-0876195e.js";const re={class:"admin"},ae={class:"container py-5"},ne={class:"d-flex align-items-center justify-content-between flex-wrap gap-2 mb-4"},ie={class:"card mb-4"},de={class:"d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2"},ce={key:0,class:"text-white-50 small"},ue={class:"row g-3"},me={class:"col-md-6"},ve={class:"col-md-6"},fe={class:"col-12 d-flex gap-2 flex-wrap align-items-center"},ge=["disabled"],be={key:0,class:"text-danger"},pe={key:0,class:"col-12"},_e={class:"previewWide"},he=["src"],Ue={class:"card mb-4"},ye={class:"h5 fw-bold mb-3"},we={class:"row g-3"},ke={class:"col-md-6"},Ie={class:"col-md-6"},xe={class:"col-12"},Ve={class:"col-md-4"},Fe={class:"col-md-4"},Ae={class:"col-md-4 d-flex align-items-end gap-2"},Ce=["disabled"],Ee={key:0,class:"col-12"},Me=["disabled"],De={key:1,class:"text-danger mb-0"},Se={class:"card"},Ne={class:"d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3"},Le={class:"badge"},je={key:0,class:"empty"},Te={key:1,class:"empty"},Be={key:2,class:"list"},Re={class:"left"},Oe={key:0,class:"cover"},qe=["src","alt"],Pe={class:"info"},$e={class:"name"},ze={class:"small"},Ge={class:"actions"},He=["onClick"],Qe=["onClick"],_="merchItems",We={__name:"AdminMerch",setup(Je){const x=u(!0),y=u(!1),f=u(""),a=M({orderFormUrl:"https://forms.gle/AmjDeCcUneTFepcT7",announceImageUrl:"/membres/AnnonceDesArticlesEtQRCode.png"});async function N(){x.value=!0,f.value="";try{const t=I(p,"settings","merch"),e=await ee(t);if(e.exists()){const o=e.data();a.orderFormUrl=o.orderFormUrl||a.orderFormUrl,a.announceImageUrl=o.announceImageUrl||a.announceImageUrl}else await se(t,{orderFormUrl:a.orderFormUrl,announceImageUrl:a.announceImageUrl,createdAt:U(),updatedAt:U()})}catch(t){console.error(t),f.value=(t==null?void 0:t.message)||"Erreur settings merch"}finally{x.value=!1}}async function L(){var t,e;y.value=!0,f.value="";try{await S(I(p,"settings","merch"),{orderFormUrl:((t=a.orderFormUrl)==null?void 0:t.trim())||"",announceImageUrl:((e=a.announceImageUrl)==null?void 0:e.trim())||"",updatedAt:U()})}catch(o){console.error(o),f.value=(o==null?void 0:o.message)||"Erreur sauvegarde settings"}finally{y.value=!1}}const C=u([]),w=u(!0),h=u(!1),m=u(""),c=u(null),l=M({title:"",sub:"",imageUrl:"",order:1,isVisible:!0});let V=null;const F=P(()=>[...C.value].sort((t,e)=>(t.order??999)-(e.order??999)));function E(){l.title="",l.sub="",l.imageUrl="",l.order=1,l.isVisible=!0}function j(t){c.value=t.id,l.title=t.title||"",l.sub=t.sub||"",l.imageUrl=t.imageUrl||"",l.order=Number.isFinite(t.order)?t.order:999,l.isVisible=t.isVisible!==!1}function A(){c.value=null,E()}function T(){var t,e;return(t=l.title)!=null&&t.trim()?(e=l.imageUrl)!=null&&e.trim()?"":"Lâ€™image (URL) est obligatoire.":"Le titre est obligatoire."}async function B(){var e;m.value="";const t=T();if(t)return m.value=t;h.value=!0;try{const o={title:l.title.trim(),sub:((e=l.sub)==null?void 0:e.trim())||"",imageUrl:l.imageUrl.trim(),order:Number.isFinite(l.order)?Number(l.order):999,isVisible:!!l.isVisible,updatedAt:U()};c.value?(await S(I(p,_,c.value),o),A()):(await te(D(p,_),{...o,createdAt:U()}),E())}catch(o){console.error(o),m.value=(o==null?void 0:o.message)||`Erreur Firestore (${_})`}finally{h.value=!1}}async function R(t){if(window.confirm("Supprimer cet article ?"))try{await oe(I(p,_,t)),c.value===t&&A()}catch(o){console.error(o),m.value=(o==null?void 0:o.message)||"Erreur suppression"}}return $(async()=>{await N(),w.value=!0;const t=z(D(p,_),G("order","asc"));V=H(t,e=>{C.value=e.docs.map(o=>({id:o.id,...o.data()})),w.value=!1},e=>{console.error(e),m.value=`Erreur Firestore (${_}). VÃ©rifie login admin (UID) + rules publiÃ©es.`,w.value=!1})}),Q(()=>{V&&V()}),(t,e)=>{const o=W("router-link");return n(),i("main",re,[s("div",ae,[s("div",ne,[e[8]||(e[8]=s("div",null,[s("h1",{class:"title"},"Gestion â€” Merch"),s("p",{class:"subtitle"},"Modifie lâ€™annonce et gÃ¨re les articles affichÃ©s sur la page Merch.")],-1)),J(o,{class:"btn-back",to:"/admin"},{default:K(()=>[...e[7]||(e[7]=[k("â† Retour au dashboard",-1)])]),_:1})]),s("div",ie,[s("div",de,[e[9]||(e[9]=s("h2",{class:"h5 fw-bold mb-0"},"Annonce + lien formulaire",-1)),x.value?(n(),i("span",ce,"Chargementâ€¦")):g("",!0)]),s("div",ue,[s("div",me,[e[10]||(e[10]=s("label",{class:"form-label"},"Lien du formulaire (commande)",-1)),v(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>a.orderFormUrl=r),class:"form-control",placeholder:"https://forms.gle/..."},null,512),[[b,a.orderFormUrl,void 0,{trim:!0}]])]),s("div",ve,[e[11]||(e[11]=s("label",{class:"form-label"},"Image annonce (URL)",-1)),v(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>a.announceImageUrl=r),class:"form-control",placeholder:"/membres/Annonce...png"},null,512),[[b,a.announceImageUrl,void 0,{trim:!0}]])]),s("div",fe,[s("button",{class:"btn-primary",onClick:L,disabled:y.value},d(y.value?"...":"Enregistrer settings"),9,ge),f.value?(n(),i("span",be,d(f.value),1)):g("",!0)]),a.announceImageUrl?(n(),i("div",pe,[s("div",_e,[s("img",{src:a.announceImageUrl,alt:"Preview annonce"},null,8,he)])])):g("",!0)])]),s("div",Ue,[s("h2",ye,d(c.value?"Modifier un article":"Nouvel article"),1),s("div",we,[s("div",ke,[e[12]||(e[12]=s("label",{class:"form-label"},"Titre",-1)),v(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>l.title=r),class:"form-control",placeholder:"Ex: Pull ISF"},null,512),[[b,l.title,void 0,{trim:!0}]])]),s("div",Ie,[e[13]||(e[13]=s("label",{class:"form-label"},"Sous-texte (optionnel)",-1)),v(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>l.sub=r),class:"form-control",placeholder:"Ex: tottePull.png"},null,512),[[b,l.sub,void 0,{trim:!0}]])]),s("div",xe,[e[14]||(e[14]=s("label",{class:"form-label"},"Image (URL)",-1)),v(s("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>l.imageUrl=r),class:"form-control",placeholder:"/membres/tottePull.png"},null,512),[[b,l.imageUrl,void 0,{trim:!0}]])]),s("div",Ve,[e[15]||(e[15]=s("label",{class:"form-label"},"Ordre",-1)),v(s("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>l.order=r),type:"number",class:"form-control"},null,512),[[b,l.order,void 0,{number:!0}]])]),s("div",Fe,[e[17]||(e[17]=s("label",{class:"form-label"},"Afficher",-1)),v(s("select",{"onUpdate:modelValue":e[6]||(e[6]=r=>l.isVisible=r),class:"form-select"},[...e[16]||(e[16]=[s("option",{value:!0},"Oui",-1),s("option",{value:!1},"Non",-1)])],512),[[X,l.isVisible]])]),s("div",Ae,[s("button",{class:"btn-primary w-100",onClick:B,disabled:h.value},d(h.value?"...":c.value?"Enregistrer":"Ajouter"),9,Ce)]),c.value?(n(),i("div",Ee,[s("button",{class:"btn-ghost",onClick:A,disabled:h.value},"Annuler la modification",8,Me)])):g("",!0),m.value?(n(),i("p",De,d(m.value),1)):g("",!0)])]),s("div",Se,[s("div",Ne,[e[18]||(e[18]=s("h2",{class:"h5 fw-bold mb-0"},"Articles",-1)),s("span",Le,d(F.value.length)+" total",1)]),w.value?(n(),i("div",je,"Chargementâ€¦")):F.value.length===0?(n(),i("div",Te," Aucun article pour le moment. Ajoute-en un ðŸ‘† ")):(n(),i("div",Be,[(n(!0),i(Y,null,Z(F.value,r=>(n(),i("div",{key:r.id,class:"item"},[s("div",Re,[r.imageUrl?(n(),i("div",Oe,[s("img",{src:r.imageUrl,alt:r.title},null,8,qe)])):g("",!0),s("div",Pe,[s("div",$e,d(r.title),1),s("div",ze,[k(d(r.sub||"â€”")+" â€¢ ordre: "+d(r.order??999)+" â€¢ ",1),s("span",{class:le(r.isVisible!==!1?"ok":"off")},d(r.isVisible!==!1?"Visible":"MasquÃ©"),3)])])]),s("div",Ge,[s("button",{class:"btn-small",onClick:O=>j(r)},"Modifier",8,He),s("button",{class:"btn-small danger",onClick:O=>R(r.id)},"Supprimer",8,Qe)])]))),128))])),e[19]||(e[19]=s("p",{class:"hint"},[k(" ðŸ”§ Firestore : "),s("code",null,"settings/merch"),k(" + collection "),s("code",null,"merchItems")],-1))])])])}}},Xe=q(We,[["__scopeId","data-v-636253f3"]]);export{Xe as default};
